
<link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">

<style>
  * {
    font-family: Roboto;
    font-size: 32px;
    box-sizing: border-box;
  }
  body {
    margin: 0;
  }
  #copy-area {
    top: -1000px;
    position: absolute;
  }
  .content {
    display: flex;
    padding: 2rem;
    flex-direction: column;
    flex-wrap: wrap;
    justify-content: center;
  }
  .preview {
    width: 100%;
    margin-bottom: 2rem;
    border-radius: 1rem; 
    box-shadow: 0 0 1rem .5rem rgba(0,0,0,.1);
    display: flex;
    align-items: center;
    flex-direction: column;
  }
  .preview a {
    width: 100%;
    height: 100%;
  }
  .preview:hover {
    cursor: pointer;
  }
  .preview .thumbnail {
    height: 80vw;
    background-size: cover;
    border-radius: .5rem .5rem 0 0;
  }
  .preview .info {
    display: flex;
    width: 100%;
    flex-direction: row;
    align-items: flex-start;
    border: 1px solid #dfdfdf;
    padding: 2rem;
    border-radius: 0 0 .5rem .5rem;
  }
  .preview .info:hover {
    background-color: #f9f9f9;
  }
  .preview .icon {
    width: 1rem;
    height: 1rem;
    margin: 0 1rem 0 0;
  }
  .preview .title {
    width: 100%;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    box-sizing: border-box;
  }
</style>

<!-- Just for holding temporary string values -->
<input type="text" id="copy-area">

<div class="page">
  <div class="content"></div>
</div>

<script>
  async function fetchFiles() {
    const response = await fetch('/api/uploads');
    const filenames = await response.json();

    // Render File Previews
    filenames.forEach(file => {
      const preview = document.createElement('div');
      preview.classList.add('preview');

      
      const thumbnail = document.createElement('div');
      thumbnail.classList.add('thumbnail');
      thumbnail.style.backgroundImage = `url(/uploads/${encodeURI(file)})`;

      const link = document.createElement('a');
      link.setAttribute('href', `/uploads/${file}`);
      link.setAttribute('target', 'blank');

      const img = document.createElement('img');
      img.setAttribute('src', `/uploads/${file}`);

      const info = document.createElement('div');
      info.classList.add('info');

      const icon = document.createElement('img');
      icon.setAttribute('src', '/icons/light/file-media.svg');
      icon.classList.add('icon');

      const title = document.createElement('div');
      title.classList.add('title');
      title.innerText = file;

      info.appendChild(icon);
      info.appendChild(title);
      preview.appendChild(link);
      link.appendChild(thumbnail);
      preview.appendChild(info);

      // Copy filenames to the clipboard when title is clicked
      info.addEventListener('click', function(event) {
        const address = window.location.origin + '/uploads/' + encodeURI(title.innerText);
        document.querySelector('#copy-area').value = address;
        document.querySelector('#copy-area').select();
        document.execCommand('copy');
      });

      document.querySelector('.content').appendChild(preview);
    })

  }
  fetchFiles();
</script>